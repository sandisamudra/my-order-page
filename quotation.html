<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quotation</title>

  <link href="https://fonts.googleapis.com/css2?family=Nunito&display=swap" rel="stylesheet" />
  
  <style>
    body {
      font-family: 'Nunito', sans-serif;
      padding: 20px;
    }
     .invoice-container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
     .header-line {
    border-bottom: 2px solid black;
    padding-bottom: 10px;
    margin-bottom: 20px;
    margin-top: 0px;
  }
     h1 {
      margin-top: 10px;
      margin-bottom: 0px;
      text-align: left;
      font-size: 20px;
      font-weight: bold;
     }
    h2 {
      margin-top: 10px;
      margin-bottom: 0px;
      text-align: left;
      font-size: 15px;
      font-weight: normal;
    }
   #username {
      margin-bottom: 0px;
      text-align: left;
      font-size: 15px;
   }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      line-height: 1.2;
    }
   th, td {
      border: 1px solid #000;
      padding: 4px 6px; /* atas-bawah: 4px, kiri-kanan: 6px */
      text-align: left;
      font-size: 12px;
    }
    th {
      background-color: black;
      color: white;
    }

    .button-group {
      margin-top: 10px;
    }
    .button-group button {
      margin-right: 10px;
      padding: 15px 30px;
      border-radius: 10px; /* ini bikin ujung tombol jadi membulat */
      background-color: #4da6ff; /* biru muda */
      color: white; /* teks jadi putih */
      border: none; /* hapus garis tepi default */
      cursor: pointer; /* ganti kursor saat hover */ 
    }
    .button-group button:hover {
    background-color: #3399ff; /* warna saat hover */
    }
    .label-row {
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-start;
    font-size: 12px;
    margin: 8px 0;
    gap: 4px;
    font-family: Nunito, sans-serif;
}
    .label-row span:first-child {
    width: 250px;  /* Atur agar semua label panjangnya sama */
    text-align: left;
    white-space: nowrap;
    }
    .label-rowsub {
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-start;
    font-size: 12px;
    font-weight: bold;
    margin: 8px 0;
    gap: 4px;
    font-family: Nunito, sans-serif;
}
    .label-rowsub span:first-child {
    width: 250px;  /* Atur agar semua label panjangnya sama */
    text-align: left;
    white-space: nowrap;
    }
    .quotation-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 0px;
  font-size: 14px;
}
    .project-info {
  max-width: 70%;
}

.logo-header img {
  width: 150px;
  height: auto;
  object-fit: contain;
}

 #signature-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end; /* Semua konten signature ke kanan */
    justify-content: space-between;
  }
    #signature-pad {
    width: 300px;
    height: 150px;
    border: 1px solid #000;
    margin-bottom: 10px;
  }

  .button-group button {
    margin: 5px;
  }

  #saved-signature {
    flex: 1;
  }
#saved-signature img {
    display: block; 
    max-width: 100px; 
    margin-top: 20px;
}
    
    @media screen and (max-width: 600px) {
      body {
        font-family: 'Nunito', sans-serif;
      }
      .invoice-container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 5px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
  .label-row {
    flex-direction: column;
    align-items: flex-start;
    font-size: 9px;
    flex-wrap: nowrap;         /* jangan dibungkus ke bawah */
    white-space: nowrap;       /* jangan putus kalimat */
    overflow: hidden;
    text-overflow: ellipsis;   /* kasih "..." kalau kepanjangan */
    gap: 4px;
    font-family: Nunito, sans-serif;
  }
    .label-row span:first-child {
    width: 180px;  /* Atur agar semua label panjangnya sama */
    text-align: left;
    white-space: nowrap;
    }
    .label-rowsub {
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-start;
    font-size: 10px;
    font-weight: bold;
    margin: 8px 0;
    gap: 4px;
    font-family: Nunito, sans-serif;
}
    .label-rowsub span:first-child {
    width: 250px;  /* Atur agar semua label panjangnya sama */
    text-align: left;
    white-space: nowrap;
    }
    .logo-header img {
       max-width: 80px;
    margin-top: 10px;
    }
    td {
      border: 1px solid #000;
      padding: 4px 6px; /* atas-bawah: 4px, kiri-kanan: 6px */
      text-align: left;
      font-size: 7px;
    }
    th {
      font-size: 9px;
    }


      
}
    @media print {
      body {
        font-family: 'Nunito', sans-serif;
      }
      table {
      border-collapse: collapse;
      line-height: 1.8;
         }
       .button-group {
      display: none !important;
    }

        .no-print {
        display: none !important;
      }
       #signature-pad, .button-group {
   display: none !important;
    }
        
      .logo-header img {
      width: 150px;
      height: 100px;
      object-fit: contain;
}
       .label-row {
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-start;
    font-size: 12px;
    margin: 8px 0;
    gap: 4px;
    font-family: Nunito, sans-serif;
}
    .label-row span:first-child {
    width: 150px;  /* Atur agar semua label panjangnya sama */
    text-align: left;
    white-space: nowrap;
    }
      .label-rowsub {
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-start;
    font-size: 12px;
    font-weight: bold;
    margin: 8px 0;
    gap: 4px;
    font-family: Nunito, sans-serif;
}
    .label-rowsub span:first-child {
    width: 250px;  /* Atur agar semua label panjangnya sama */
    text-align: left;
    white-space: nowrap;
    }
      th {
      background-color: black !important;
      -webkit-print-color-adjust: exact; /* untuk Chrome & Safari */
      print-color-adjust: exact;         /* untuk Firefox */
      color: white;
  }
       .invoice-container {
      max-width: 950px;
      margin: auto;
      background: white;
      padding: 5px;
      border-radius: 10px;
      box-shadow: none;
    }
    }
  </style>
</head>
<body>
<div class="invoice-container">

<div class="quotation-header">
  <div class="project-info">
    <h2 style="font-size: 20px; font-weight: bold; margin-bottom: 20px;" id="project-name"></h2>
    
  <div class="label-row" id="cl-name">
  <span>Submitted To</span>
  <span>: <span id="client-name"></span></span>
  </div>
    
  <div class="label-row" id="prod-house">
  <span>Production House</span>
  <span>: <span id="production-house"></span></span>
  </div>
    
  <div class="label-row" id="comp-name">
  <span>Company</span>
  <span>: <span id="company-name"></span></span>
  </div>  
    
  <p style="margin-bottom: 0px; font-size: 12px;" id="comp-address">Company Address</p>  
  <p style="margin-top: 0px; font-size: 12px;" id="company-address"></p>
    
  <div class="label-row">
  <span>Quotation Number</span>
  <span>: <span id="quote-number"></span></span>
  </div>

   <div class="label-row" id="shooting-date">
  <span>Production Date</span>
  <span>: <span id="production-date"></span></span>
  </div>
    
  </div>
  
  <div class="logo-header">
    <img id="wgs-logo" src="https://storage.googleapis.com/glide-prod.appspot.com/uploads-v2/S13sj8xtWBiEXkgUeQZc/pub/ex3AkCwO66H8VBGPNJ8A.png" alt="wgs logo">
  </div>
  </div>
  
  <div class="header-line"></div>
  <p style="margin-top: 10px; margin-bottom: 0px; font-weight: bold; font-size: 15px; font-family: 'Nunito', sans-serif;">PT Warna Global Surya</p>
  <p style="margin-bottom: 0px; margin-top: 10px; font-size: 16px; font-weight: bold; font-family: 'Nunito', sans-serif;">Equipments</p>
  

  <!-- Tabel Equipments -->
  <div id="equipment-section"></div>

  <!-- Total Cost Equipments -->
  <div class="label-rowsub">
  <span style="margin-bottom: 20px;">Subtotal Equipments</span>
  <span>: <span id="total-cost-orders"></span></span>
</div>


  <!-- Tabel Guard and Others -->
  <p style="margin-bottom: 0px; margin-top: 0px; font-size: 16px; font-weight: bold; font-family: 'Nunito', sans-serif;">Guard and Others</p>
  <table style="margin-top: 5px;" id="guard-table">
    <thead>
      <tr>
        <th>Subject</th>
        <th>Cost</th>
        <th>Quantity</th>
        <th>Day</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Total Cost Guard and Others -->
  <div class="label-rowsub">
  <span>Subtotal Guard and Others</span>
  <span>: <span id="total-cost-go"></span></span>
  </div>

  <!-- Discount -->
  <div class="label-rowsub" id="discount-equipments">
  <span>Discount for Equipments</span>
  <span>: <span id="discount-for-equipments"></span></span>
  </div>
  <div class="label-rowsub" id="add-discount">
  <span>Additional Discount</span>
  <span>: <span id="additional-discount"></span></span>
  </div>

   <!-- After Discount -->
  <div class="label-rowsub">
  <span>Total for Equipments</span>
  <span>: <span id="after-discount"></span></span>
  </div>

  <!-- Grand Total -->
  <div class="label-rowsub">
  <span>Grand Total</span>
  <span>: <span id="grand-total"></span></span>
  </div>
  “<em id="grand-total-text">[Grand Total Text]</em>“

  <div style="display: flex; justify-content: space-between; margin-top: 5px;">
  <p style="text-align: left;">Tenant Party</p>
  <p style="text-align: right;">Jakarta, <strong id="quotation-date">September 13 2025</strong></p>
  </div>
    
  <div id="signature-container">
  <canvas id="signature-pad" class="signature-pad"></canvas>
  <div class="button-group">
    <button onclick="clearSignature()">Clear</button>
    <button onclick="saveSignature()">Save</button>
    <input type="file" id="upload-signature" accept="image/*" style="display: none;" onchange="handleUpload(event)">
    <button onclick="document.getElementById('upload-signature').click()">Upload Signature</button>
    <button onclick="window.print()">Print</button>
  </div>
  <div id="saved-signature"></div>
  </div>
  <div style="display: flex; justify-content: space-between; margin-top: 1px !important;">
  <div style="text-align: center;">
    <div style="border-top: 1px solid #000; width: 200px; margin-bottom: 1px !important;"></div>
    <p style="text-align: left; margin-top: 2px !important;" id="name-client">Tenant Party</p>
  </div>
  <div style="text-align: center;">
    <div style="border-top: 1px solid #000; width: 200px; margin-bottom: 1px !important;"></div>
    <p style="text-align: right; margin-top: 1px !important;" id="user-name">Rental Party</p>
  </div>

  </div>

 
 
  
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const project = urlParams.get("project") || "";
    const productionHouse = urlParams.get("productionHouse") || "";
    const productionDate = urlParams.get("productionDate") || "";
    const quotationDate = urlParams.get("quotationDate") || "";
    const companyName = urlParams.get("companyName") || "";
    const companyAddress = urlParams.get("companyAddress") || "";
    const clientName = urlParams.get("clientName") || "";
    const nameClient = urlParams.get("nameClient") || "";
    const quoteNumber = urlParams.get("quoteNumber") || "";
    const user = urlParams.get("user") || "";
    const orders = urlParams.get("orders") || "";
    const categoryList = urlParams.get("category")?.split("||") || [];
    const totalcostorders = urlParams.get("totalcostorders") || "";
    const totalcostGO = urlParams.get("totalcostGO") || "";
    const discount = urlParams.get("discount") || "";
    const afterDiscount = urlParams.get("afterDiscount") || "";
    const grandtotal = urlParams.get("grandtotal") || "";
    const fileName = urlParams.get("fileName") || "";
    const additionalDiscount = urlParams.get("additionalDiscount") || "";
    const userName = urlParams.get("userName") || "";

     if (fileName) {
    document.title = fileName;
  }    
    function formatCurrency(numberStr) {
    const number = parseFloat(numberStr.replace(/,/g, ""));
    if (isNaN(number)) return numberStr;
    return number.toLocaleString("id-ID") + " IDR";
  }

 function numberToWords(num) {
      const angka = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
      const belasan = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", 
                       "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
      const puluhan = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
      const ribuan = ["", "Thousand", "Million", "Billion"];

      if (isNaN(num)) return "";

      let str = "";
      let i = 0;
      while (num > 0) {
        let s = "";
        let n = num % 1000;
        if (n >= 100) {
          s += angka[Math.floor(n / 100)] + " Hundred ";
          n %= 100;
        }
        if (n >= 10 && n <= 19) {
          s += belasan[n - 10] + " ";
        } else {
          if (n >= 20) {
            s += puluhan[Math.floor(n / 10)] + " ";
          }
          if (n % 10 > 0) {
            s += angka[n % 10] + " ";
          }
        }
        if (s) {
          str = s + ribuan[i] + " " + str;
        }
        num = Math.floor(num / 1000);
        i++;
      }
      return str.trim();
    };

    function toTitleCase(str) {
  return str.replace(/\w\S*/g, function(txt) {
    return txt.charAt(0).toUpperCase() + txt.substring(1).toLowerCase();
  });
}
    function formatRupiah(angka) {
  return 'Rp' + parseInt(angka).toLocaleString('id-ID');
}
   
const textAmountRaw = numberToWords(parseInt(grandtotal));
const textAmount = toTitleCase(textAmountRaw);

    document.getElementById("user-name").innerText                     = userName;
    document.getElementById("project-name").innerText                     = project;
    document.getElementById("production-house").innerText                 = productionHouse;
    document.getElementById("production-date").innerText                  = productionDate;
    document.getElementById("quotation-date").innerText                  = quotationDate;
    document.getElementById("company-name").innerText                     = companyName;
    document.getElementById("company-address").innerText                  = companyAddress;
    document.getElementById("client-name").innerText                      = clientName;
    document.getElementById("name-client").innerText                      = nameClient;
    document.getElementById("quote-number").innerText                     = quoteNumber;
    document.getElementById("total-cost-orders").innerText                = formatCurrency(totalcostorders);
    document.getElementById("total-cost-go").innerText                    = formatCurrency(totalcostGO);
    document.getElementById("discount-for-equipments").innerText          = discount + "%";
    document.getElementById("additional-discount").innerText              = formatCurrency(additionalDiscount);
    document.getElementById("after-discount").innerText                   = formatCurrency(afterDiscount);
    document.getElementById("grand-total").innerText                      = formatCurrency(grandtotal);
    document.getElementById("grand-total-text").innerText                 = `${textAmount}`;

    const equipmentSection = document.getElementById("equipment-section");
    const equipmentData = orders.split("||");
    let categoryIndex = 0;
    let currentTable = null;
    let tbody = null;
    let rowCount = 0;

    const parsedEquipment = equipmentData.map(row => {
  const [category, item, cost, qty, day, amount] = row.split("|");
  return { category, item, cost, qty, day, amount };
});

// Kelompokkan berdasarkan kategori
const groupedEquipment = {};
parsedEquipment.forEach(entry => {
  if (!groupedEquipment[entry.category]) groupedEquipment[entry.category] = [];
  groupedEquipment[entry.category].push(entry);
});

Object.keys(groupedEquipment).forEach(category => {
  const header = document.createElement("h2");
  header.textContent = category;
  equipmentSection.appendChild(header);

  const table = document.createElement("table");
  const thead = document.createElement("thead");
  thead.innerHTML = `
    <tr>
      <th>Item</th>
      <th>Cost</th>
      <th>Quantity</th>
      <th>Day</th>
      <th>Amount</th>
    </tr>`;
  table.appendChild(thead);

  const tbody = document.createElement("tbody");
  groupedEquipment[category].forEach(({ item, cost, qty, day, amount }) => {
    const tr = document.createElement("tr");
    [item, cost, qty, day, amount].forEach((text, index) => {
      const td = document.createElement("td");
      const isPackage = category.toLowerCase().includes("package");
      if (index === 0 && isPackage) {
        td.innerHTML = text; // render <br> untuk paket
      } else {
        td.textContent = text;
      }
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  table.appendChild(tbody);
  equipmentSection.appendChild(table);
});
window.addEventListener("DOMContentLoaded", function () {
    const guardOrders = decodeURIComponent(decodeURIComponent(urlParams.get("guardorders") || ""));
    console.log("Decoded guardOrders:", guardOrders);

    const guardData = guardOrders.split("||");
    const guardTableBody = document.querySelector("#guard-table tbody");

    guardData.forEach(row => {
      const columns = row.split("|");
      if (columns.length !== 5) return;

      const [subject, cost, qty, day, amount] = columns;
      const tr = document.createElement("tr");

      [subject, cost, qty, day, amount].forEach((text, index) => {
        const td = document.createElement("td");
        if (index === 0) {
          td.innerHTML = text;
        } else {
          td.textContent = text;
        }
        tr.appendChild(td);
      });

      guardTableBody.appendChild(tr);
    });
  });

const canvas = document.getElementById("signature-pad");
  const ctx = canvas.getContext("2d");
  let drawing = false;

  function resizeCanvas() {
    const ratio = window.devicePixelRatio || 1;
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    ctx.scale(ratio, ratio);
    ctx.lineWidth = 2;
    ctx.lineJoin = "round";
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  function getXY(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return {
      x: clientX - rect.left,
      y: clientY - rect.top
    };
  }

  function startDraw(e) {
    drawing = true;
    const { x, y } = getXY(e);
    ctx.beginPath();
    ctx.moveTo(x, y);
    e.preventDefault();
  }

  function draw(e) {
    if (!drawing) return;
    const { x, y } = getXY(e);
    ctx.lineTo(x, y);
    ctx.stroke();
    e.preventDefault();
  }

  function endDraw() {
    drawing = false;
  }

  canvas.addEventListener("mousedown", startDraw);
  canvas.addEventListener("mousemove", draw);
  canvas.addEventListener("mouseup", endDraw);
  canvas.addEventListener("mouseleave", endDraw);

  canvas.addEventListener("touchstart", startDraw);
  canvas.addEventListener("touchmove", draw);
  canvas.addEventListener("touchend", endDraw);

  function clearSignature() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById("saved-signature").innerHTML = "";
  }

  function saveSignature() {
    const dataURL = canvas.toDataURL("image/png");
    const img = document.createElement("img");
    img.src = dataURL;
    img.style.maxWidth = "150px";
    img.style.marginTop = "0px";

    document.getElementById('saved-signature').innerHTML = "";
    document.getElementById("saved-signature").appendChild(img);
    // Misal ada variabel isSigned = true kalau sudah tanda tangan
  }
    function handleUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      const img = document.createElement("img");
      img.src = e.target.result;
      img.style.maxWidth = "160px";
      img.style.marginTop = "0px";

      document.getElementById('saved-signature').innerHTML = "";
      document.getElementById("saved-signature").appendChild(img);
    };
    reader.readAsDataURL(file);
  }
    

    if (clientName === "") {
      document.getElementById("cl-name").style.display = "none";
    }
    if (companyName === "") {
      document.getElementById("comp-name").style.display = "none";
    }
    if (productionHouse === "") {
      document.getElementById("prod-house").style.display = "none";
    }
    if (productionDate === "") {
      document.getElementById("shooting-date").style.display = "none";
    }
    if (companyAddress === "") {
      document.getElementById("comp-address").style.display = "none";
    }
    if (discount === "") {
      document.getElementById("discount-equipments").style.display = "none";
    }
    if (additionalDiscount === "") {
      document.getElementById("add-discount").style.display = "none";
    }

  
  </script>
</body>
</html>
