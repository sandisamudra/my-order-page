<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Invoice</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }

    .invoice-container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

   .info-line, .grand-total, .note {
      margin-top: 20px;
      font-size: 16px;
    }

    .grand-total {
      font-weight: bold;
      text-align: right;
    }

    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
    }
@media print {
      #signature-pad, .button-group {
    display: none !important;
    height: 0 !important;
    visibility: hidden;
      }
     .signature-pad {
      border: 1px solid #000;
      width: 50%;
      height: 200px;
      border-radius: 10px; /* ini bikin ujung tombol jadi membulat */
    }
    .button-group {
      margin-top: 10px;
    }
    .button-group button {
      margin-right: 10px;
      padding: 15px 30px;
      border-radius: 10px; /* ini bikin ujung tombol jadi membulat */
      background-color: #4da6ff; /* biru muda */
      color: white; /* teks jadi putih */
      border: none; /* hapus garis tepi default */
      cursor: pointer; /* ganti kursor saat hover */ 
    }
    .button-group button:hover {
    background-color: #3399ff; /* warna saat hover */
    }
  </style>
</head>
<body>
  <div class="invoice-container">
    <h1>INVOICE</h1>

    <table>
      <thead>
        <tr>
          <th>Termin</th>
          <th>Description</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="termin"></td>
          <td id="desc"></td>
          <td id="amount"></td>
        </tr>
      </tbody>
    </table>

    <div class="info-line"></div>
    <div class="grand-total" id="grand-total"></div>
    <div class="note" id="grand-total-text"></div>


  <p style="margin-top: 30px; font-weight: normal; font-size: 15px;">Regards,</p>
  <canvas id="signature-pad" class="signature-pad"></canvas>
  <div class="button-group">
    <button onclick="clearSignature()">Clear</button>
    <button onclick="saveSignature()">Save</button>
    <button onclick="window.print()">Print</button>
  </div>
  <div id="saved-signature"></div>
  <p style="font-weight: normal, font-size: 20px;"did="username"></p>
  <p style="margin-top: 0px; font-weight: bold; font-size: 15px;">PT Warna Global Surya</p>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const termin = urlParams.get("termin") || "";
    const desc = urlParams.get("desc") || "";
    const amount = urlParams.get("amount") || "0";
    const terminPercentage = urlParams.get("terminPercentage") || "";
    const subtotalAmount = urlParams.get("subtotalAmount") || "0";
    const username = urlParams.get("username") || "";

    function formatCurrency(value) {
      const num = parseFloat(value);
      return new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0
      }).format(num);
    }

    function numberToWords(num) {
      const angka = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
      const belasan = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", 
                       "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
      const puluhan = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
      const ribuan = ["", "Thousand", "Million", "Billion"];

      if (isNaN(num)) return "";

      let str = "";
      let i = 0;
      while (num > 0) {
        let s = "";
        let n = num % 1000;
        if (n >= 100) {
          s += angka[Math.floor(n / 100)] + " Hundred ";
          n %= 100;
        }
        if (n >= 10 && n <= 19) {
          s += belasan[n - 10] + " ";
        } else {
          if (n >= 20) {
            s += puluhan[Math.floor(n / 10)] + " ";
          }
          if (n % 10 > 0) {
            s += angka[n % 10] + " ";
          }
        }
        if (s) {
          str = s + ribuan[i] + " " + str;
        }
        num = Math.floor(num / 1000);
        i++;
      }
      return str.trim();
    }

    const formattedAmount = formatCurrency(amount);
    const formattedSubtotal = formatCurrency(subtotalAmount);
    const textAmount = numberToWords(parseInt(subtotalAmount)).toLowerCase();

    document.getElementById("termin").innerText = termin;
    document.getElementById("username").innerText = username;
    document.getElementById("desc").innerText = desc;
    document.getElementById("amount").innerText = formattedAmount;

    document.getElementById("grand-total").innerText = `Grand Total = ${formattedSubtotal}`;
    document.getElementById("grand-total-text").innerText = `Note: ${textAmount} rupiahs`;

     // Signature pad
    const canvas = document.getElementById("signature-pad");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    ctx.lineWidth = 2;
    ctx.lineJoin = "round";
    ctx.lineCap = "round";
    canvas.addEventListener("mousedown", startDraw);
    canvas.addEventListener("mousemove", draw);
    canvas.addEventListener("mouseup", endDraw);
    canvas.addEventListener("touchstart", startDraw);
    canvas.addEventListener("touchmove", draw);
    canvas.addEventListener("touchend", endDraw);

    function startDraw(e) {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(getX(e), getY(e));
      e.preventDefault();
    }

    function draw(e) {
      if (!drawing) return;
      ctx.lineTo(getX(e), getY(e));
      ctx.stroke();
      e.preventDefault();
    }

    function endDraw(e) {
      drawing = false;
      e.preventDefault();
    }

   function getCanvasRelativePosition(e) {
  const rect = canvas.getBoundingClientRect();
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const clientY = e.touches ? e.touches[0].clientY : e.clientY;

  return {
    x: clientX - rect.left,
    y: clientY - rect.top
  };
}

function getX(e) {
  return getCanvasRelativePosition(e).x;
}

function getY(e) {
  return getCanvasRelativePosition(e).y;
}

    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById("saved-signature").innerHTML = "";
    }

    function saveSignature() {
      const dataURL = canvas.toDataURL();
      const img = document.createElement("img");
      img.src = dataURL;
      img.style.maxWidth = "300px";
      document.getElementById("saved-signature").innerHTML = "";
      document.getElementById("saved-signature").appendChild(img);
    }
  </script>
</body>
</html>
