<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Invoice</title>
  <style>
    body {
      font-family: Calibri;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
     #logo-container {
      position: relative;
      width: 100%;
      height: 80px;
      margin-bottom: -40px;
    }
     #wgs-logo {
      position: relative;
      z-index: 1;
      height: 100px;
      width: 150px;
      margin-top: 15px;
    }
    .invoice-container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
         .header-line {
    border-bottom: 2px solid black;
    padding-bottom: 10px;
    margin-bottom: 20px;
  }

    h1 {
      text-align: left;
      margin-bottom: 0px;
      margin-top: 90px;
      font-size: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 40px;
      margin-bottom: 40px;
    }

    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

   .info-line, .grand-total, .note {
      margin-top: 20px;
      font-size: 16px;
    }

    .grand-total {
      font-weight: bold;
      text-align: right;
    }
    #signature-placeholder {
    display: block; /* Sembunyi dulu */
    width: 200px;
    height: 80px;
    margin-top: 20px;
    border-bottom: 1px solid #000;
  }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      h1 {
        font-size: 15px;
        font-family: Calibri;
      }
    }
@media print {
      #signature-pad, .button-group {
    display: none !important;
    height: 0 !important;
    visibility: hidden;
      }
   #signature-placeholder {
      display: block;
      height: 80px; /* Tinggi ruang kosong untuk tanda tangan manual */
      border-bottom: 1px solid #000;
      margin-top: 20px;
      width: 200px; /* Bisa diatur sesuai kebutuhan */
    }
   #saved-signature img {
      display: block;
      max-width: 200px;
      margin-top: 20px;
    }
  h1 {
        font-size: 15px;
        font-family: Calibri;
      }
  .invoice-container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: none;
    }
}
   .signature-pad {
  border: 2px dashed #ccc;
  width: 50%;
  height: 200px;
  border-radius: 8px;
  background-color: #fff;
  margin-top: 10px;
  touch-action: none;
}

.button-group {
  margin-top: 10px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.button-group button {
  padding: 10px 20px;
  font-size: 14px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.button-group button:hover {
  background-color: #0056b3;
}
       .label-row {
    display: flex;
    justify-content: flex-start;
    font-size: 14px;
    margin: 8px 0;
    gap: 1%;
}
    .label-row span:first-child {
  width: 200px;  /* Atur agar semua label panjangnya sama */
  text-align: left;
    }
  </style>
</head>
<body>
  <div class="invoice-container">
    <div id="logo-container">
    <img id="wgs-logo" src="https://storage.googleapis.com/glide-prod.appspot.com/uploads-v2/S13sj8xtWBiEXkgUeQZc/pub/VPXK7SWcli5VwFmfG0wr.png" alt="WGS Logo">
  </div>
    <h1>INVOICE</h1> 
  <div class="label-row">
  <span>Submitted To</span>
  <span>: <span id="client-name"></span></span>
  </div>
  <div class="label-row">
  <span>Production House/Company</span>
  <span>: <span id="production-house"></span></span>
  </div>
  <div class="label-row">
  <span>Project Name</span>
  <span>: <span id="project-name"></span></span>
  </div>
  <div class="label-row">
  <span>Invoice Number</span>
  <span>: <span id="invoice-number"></span></span>
  </div>
    <div class="header-line"></div>
    <table>
      <thead>
        <tr>
          <th>Subject</th>
          <th>Description</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="termin"></td>
          <td id="desc"></td>
          <td id="amount"></td>
        </tr>
      </tbody>
    </table>

    <div class="info-line"></div>
    <div class="label-row">
    <span>Grand Total</span>
    <span>: <span id="grand-total"></span></span>
    </div>
  
    <div style="font-size: 12px; font-style: italic;" class="note" id="grand-total-text"></div>


  <p style="margin-top: 30px; font-weight: normal; font-size: 15px;">Regards,</p>
  <canvas id="signature-pad" class="signature-pad"></canvas>
  <div class="button-group">
    <button onclick="clearSignature()">Clear</button>
    <button onclick="saveSignature()">Save</button>
    <button onclick="window.print()">Print</button>
  </div>
  <div id="saved-signature"></div>
  
  <p style="font-weight: normal; font-size: 20px;"id="username"></p>
  <p style="margin-top: 0px; font-weight: bold; font-size: 15px;">PT Warna Global Surya</p>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const termin = urlParams.get("termin") || "";
    const desc = urlParams.get("desc") || "";
    const amount = urlParams.get("amount") || "0";
    const terminPercentage = urlParams.get("terminPercentage") || "";
    const subtotalAmount = urlParams.get("subtotalAmount") || "0";
    const username = urlParams.get("username") || "";
    const clientName = urlParams.get("clientName") || "";
    const productionHouse = urlParams.get("productionHouse") || "";
    const projectName = urlParams.get("projectName") || "";
    const invoiceNumber = urlParams.get("invoiceNumber") || "";  
    const fileName = urlParams.get("fileName") || "";

     if (fileName) {
    document.title = fileName;
  }    
  
    function formatCurrency(value) {
      const num = parseFloat(value);
      return new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0
      }).format(num);
    }

    function numberToWords(num) {
      const angka = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
      const belasan = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", 
                       "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
      const puluhan = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
      const ribuan = ["", "Thousand", "Million", "Billion"];

      if (isNaN(num)) return "";

      let str = "";
      let i = 0;
      while (num > 0) {
        let s = "";
        let n = num % 1000;
        if (n >= 100) {
          s += angka[Math.floor(n / 100)] + " Hundred ";
          n %= 100;
        }
        if (n >= 10 && n <= 19) {
          s += belasan[n - 10] + " ";
        } else {
          if (n >= 20) {
            s += puluhan[Math.floor(n / 10)] + " ";
          }
          if (n % 10 > 0) {
            s += angka[n % 10] + " ";
          }
        }
        if (s) {
          str = s + ribuan[i] + " " + str;
        }
        num = Math.floor(num / 1000);
        i++;
      }
      return str.trim();
    }

    const formattedAmount = formatCurrency(amount);
    const formattedSubtotal = formatCurrency(subtotalAmount);

    function toTitleCase(str) {
  return str.replace(/\w\S*/g, function(txt) {
    return txt.charAt(0).toUpperCase() + txt.substring(1).toLowerCase();
  });
}

const textAmountRaw = numberToWords(parseInt(subtotalAmount));
const textAmount = toTitleCase(textAmountRaw);


    document.getElementById("termin").innerText = termin;
    document.getElementById("username").innerText = username;
    document.getElementById("desc").innerText = desc;
    document.getElementById("amount").innerText = formattedAmount;
    document.getElementById("client-name").innerText = clientName;
    document.getElementById("production-house").innerText = productionHouse;
    document.getElementById("project-name").innerText = projectName;
    document.getElementById("invoice-number").innerText = invoiceNumber;

    document.getElementById("grand-total").innerText = `${formattedSubtotal}`;
    document.getElementById("grand-total-text").innerText = `Note : ${textAmount} Rupiahs`;

  const canvas = document.getElementById("signature-pad");
  const ctx = canvas.getContext("2d");
  let drawing = false;

  function resizeCanvas() {
    const ratio = window.devicePixelRatio || 1;
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    ctx.scale(ratio, ratio);
    ctx.lineWidth = 2;
    ctx.lineJoin = "round";
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  function getXY(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return {
      x: clientX - rect.left,
      y: clientY - rect.top
    };
  }

  function startDraw(e) {
    drawing = true;
    const { x, y } = getXY(e);
    ctx.beginPath();
    ctx.moveTo(x, y);
    e.preventDefault();
  }

  function draw(e) {
    if (!drawing) return;
    const { x, y } = getXY(e);
    ctx.lineTo(x, y);
    ctx.stroke();
    e.preventDefault();
  }

  function endDraw() {
    drawing = false;
  }

  canvas.addEventListener("mousedown", startDraw);
  canvas.addEventListener("mousemove", draw);
  canvas.addEventListener("mouseup", endDraw);
  canvas.addEventListener("mouseleave", endDraw);

  canvas.addEventListener("touchstart", startDraw);
  canvas.addEventListener("touchmove", draw);
  canvas.addEventListener("touchend", endDraw);

  function clearSignature() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById("saved-signature").innerHTML = "";
  }

  function saveSignature() {
    const dataURL = canvas.toDataURL("image/png");
    const img = document.createElement("img");
    img.src = dataURL;
    img.style.maxWidth = "100px";
    img.style.marginTop = "0px";

    document.getElementById('saved-signature').innerHTML = "";
    document.getElementById("saved-signature").appendChild(img);
    // Misal ada variabel isSigned = true kalau sudah tanda tangan
  }
</script>

</script>

</script>
</body>
</html>
