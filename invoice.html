<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Invoice</title>

  <link href="https://fonts.googleapis.com/css2?family=Nunito&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Nunito', sans-serif;
      margin: 0;
      padding: 20px;
      background: white;
    }
    #logo-container { width: 100%; height: 80px; margin-bottom: -40px; }
    #wgs-logo { height: 100px; width: 150px; margin-top: 15px; }
    #cmk-logo { height: 100px; width: 150px; margin-top: 15px; }
    .invoice-container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .header-line { border-bottom: 2px solid black; padding-bottom: 10px; margin-bottom: 20px; }
    h1 { margin-top: 90px; font-size: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 40px; margin-bottom: 10px; }
    th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
    th { background-color: #f2f2f2; }
    .info-line, .grand-total, .note { margin-top: 20px; font-size: 16px; }
    .grand-total { font-weight: bold; text-align: right; }
    .signature-pad { border: 2px dashed #ccc; width: 50%; height: 200px; border-radius: 8px; background-color: #fff; margin-top: 10px; touch-action: none; }
    .button-group { margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
    .button-group button { padding: 10px 20px; font-size: 14px; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; transition: background-color 0.3s ease; }
    .button-group button:hover { background-color: #0056b3; }
    .label-row { display: flex; justify-content: flex-start; font-size: 14px; margin: 8px 0; gap: 1%; }
    .label-row span:first-child { width: 200px; text-align: left; }
    @media (max-width: 932px) {
      .label-row { font-size: 12px; }
      body { padding: 10px; font-size: 12px; }
      h1 { font-size: 15px; }
      #wgs-logo { height: 80px; width: 120px; margin-top: 15px; }
      #cmk-logo { height: 80px; width: 120px; margin-top: 15px; }
    }
    @media print {
      #signature-pad, .button-group { display: none !important; }
      #saved-signature img { display: block; max-width: 200px; margin-top: 20px; }
      .invoice-container { background: white; box-shadow: none !important; border: none !important; border-radius: 0 !important; margin: auto; padding: auto; }
    }
  </style>
</head>
<body>
  <div class="invoice-container">
    <div id="logo-container">
      <img id="wgs-logo" src="https://storage.googleapis.com/glide-prod.appspot.com/uploads-v2/S13sj8xtWBiEXkgUeQZc/pub/ex3AkCwO66H8VBGPNJ8A.png" alt="WGS Logo">
      <img id="cmk-logo" src="https://storage.googleapis.com/glide-prod.appspot.com/uploads-v2/S13sj8xtWBiEXkgUeQZc/pub/7Epj1GKGFMNBv57gkdlP/CMK%20Logo.jpeg" alt="CMK Logo">
    </div>
    <h1>INVOICE</h1> 

    <div class="label-row" id="submit-to"><span>Submitted To</span><span>: <span id="client-name"></span></span></div>
    <div class="label-row" id="prod-house"><span>Production House/Company</span><span>: <span id="production-house"></span></span></div>
    <div class="label-row" id="comp-name"><span>Company</span><span>: <span id="company-name"></span></span></div>
    <div class="label-row"><span>Project Name</span><span>: <span id="project-name"></span></span></div>
    <div class="label-row" id="invoice-number-row"><span>Invoice Number</span><span>: <span id="invoice-number"></span></span></div>
    <div class="label-row"><span>Invoice Date</span><span>: <span id="invoice-date"></span></span></div>

    <div class="header-line"></div>
    <table>
      <thead>
        <tr><th>Subject</th><th>Description</th><th>Amount</th></tr>
      </thead>
      <tbody>
        <tr><td id="termin"></td><td id="desc"></td><td id="amount"></td></tr>
      </tbody>
    </table>

    <div class="info-line"></div>
    <!-- Tax Row (hidden by default) -->
    <div class="label-row" id="tax-row" style="display: none;">
      <span id="tax-label">Tax</span>
      <span>: <span id="tax-amount"></span></span>
    </div>

    <div class="info-line"></div>
    <div class="label-row">
      <span>Grand Total</span>
      <span>: <span id="grand-total"></span></span>
    </div>
  
    <div style="font-size: 12px; font-style: italic; margin-top: 0px; margin-bottom: 10px;" class="note" id="grand-total-text"></div>

    <p style="font-weight: bold; font-size: 15px; margin-bottom: 0px;">Transfer To</p>  
    <div class="label-row"><span>Bank Name</span><span>: <span id="bank-name"></span></span></div>
    <div class="label-row"><span>Bank Account Name</span><span>: <span id="bank-account-name"></span></span></div>
    <div class="label-row"><span>Bank Account Number</span><span>: <span id="bank-account-number"></span></span></div>
    
    <p style="margin-top: 10px; font-weight: normal; font-size: 15px;">Regards,</p>
    <canvas id="signature-pad" class="signature-pad"></canvas>
    <div class="button-group">
      <button onclick="clearSignature()">Clear</button>
      <button onclick="saveSignature()">Save</button>
      <input type="file" id="upload-signature" accept="image/*" style="display: none;" onchange="handleUpload(event)">
      <button onclick="document.getElementById('upload-signature').click()">Upload Signature</button>
      <button onclick="window.print()">Print</button>
    </div>
    <div id="saved-signature"></div>
  
    <p style="font-weight: normal; margin-bottom: 0px; font-size: 15px;" id="username"></p>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const termin = urlParams.get("termin") || "";
    const desc = urlParams.get("desc") || "";
    const amount = urlParams.get("amount") || "0";
    const taxAmount = urlParams.get("taxAmount") || "0"; // <-- tetap dipakai
    const subtotalAmount = urlParams.get("subtotalAmount") || "0";
    const username = urlParams.get("username") || "";
    const clientName = urlParams.get("clientName") || "";
    const productionHouse = urlParams.get("productionHouse") || "";
    const companyName = urlParams.get("companyName") || "";
    const projectName = urlParams.get("projectName") || "";
    const invoiceNumber = urlParams.get("invoiceNumber") || "";  
    const fileName = urlParams.get("fileName") || "";
    const bankName = urlParams.get("bankName") || "";
    const bankAccountName = urlParams.get("bankAccountName") || "";
    const bankAccountNumber = urlParams.get("bankAccountNumber") || "";
    const date = urlParams.get("date") || "";

    if (fileName) document.title = fileName;

    function formatCurrency(value) {
      const num = parseFloat(value);
      return new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0
      }).format(num);
    }

    function numberToWords(num) {
      const angka = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
      const belasan = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", 
                       "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
      const puluhan = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
      const ribuan = ["", "Thousand", "Million", "Billion"];
      if (isNaN(num)) return "";
      let str = ""; let i = 0;
      while (num > 0) {
        let s = ""; let n = num % 1000;
        if (n >= 100) { s += angka[Math.floor(n / 100)] + " Hundred "; n %= 100; }
        if (n >= 10 && n <= 19) { s += belasan[n - 10] + " "; }
        else {
          if (n >= 20) { s += puluhan[Math.floor(n / 10)] + " "; }
          if (n % 10 > 0) { s += angka[n % 10] + " "; }
        }
        if (s) { str = s + ribuan[i] + " " + str; }
        num = Math.floor(num / 1000); i++;
      }
      return str.trim();
    }

    function toTitleCase(str) {
      return str.replace(/\w\S*/g, function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substring(1).toLowerCase();
      });
    }

    // Masukkan data utama
    document.getElementById("termin").innerText = termin;
    document.getElementById("username").innerText = username;
    document.getElementById("desc").innerText = desc;
    document.getElementById("amount").innerText = formatCurrency(amount);
    document.getElementById("client-name").innerText = clientName;
    document.getElementById("production-house").innerText = productionHouse;
    document.getElementById("company-name").innerText = companyName;
    document.getElementById("project-name").innerText = projectName;
    document.getElementById("invoice-number").innerText = invoiceNumber;
    document.getElementById("bank-name").innerText = bankName;
    document.getElementById("bank-account-name").innerText = bankAccountName;
    document.getElementById("bank-account-number").innerText = bankAccountNumber;
    document.getElementById("invoice-date").innerText = date;

    // === HITUNG TAX & GRAND TOTAL ===
    let grandTotal = parseFloat(subtotalAmount);

    if (!isNaN(parseFloat(taxAmount)) && parseFloat(taxAmount) > 0) {
      const taxValue = (parseFloat(subtotalAmount) * parseFloat(taxAmount)) / 100;
      document.getElementById("tax-row").style.display = "flex";
      document.getElementById("tax-label").innerText = `Tax (${taxAmount}%)`;
      document.getElementById("tax-amount").innerText = formatCurrency(taxValue);
      grandTotal += taxValue;
    }

    document.getElementById("grand-total").innerText = formatCurrency(grandTotal);

    const textAmountRaw = numberToWords(parseInt(grandTotal));
    const textAmount = toTitleCase(textAmountRaw);
    document.getElementById("grand-total-text").innerText = `Note : ${textAmount} Rupiahs`;

    // === SIGNATURE PAD ===
    const canvas = document.getElementById("signature-pad");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    function resizeCanvas() {
      const ratio = window.devicePixelRatio || 1;
      canvas.width = canvas.offsetWidth * ratio;
      canvas.height = canvas.offsetHeight * ratio;
      ctx.scale(ratio, ratio);
      ctx.lineWidth = 2; ctx.lineJoin = "round"; ctx.lineCap = "round"; ctx.strokeStyle = "#000";
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
    window.addEventListener("resize", resizeCanvas); resizeCanvas();
    function getXY(e) { const rect = canvas.getBoundingClientRect(); const clientX = e.touches ? e.touches[0].clientX : e.clientX; const clientY = e.touches ? e.touches[0].clientY : e.clientY; return { x: clientX - rect.left, y: clientY - rect.top }; }
    function startDraw(e) { drawing = true; const { x, y } = getXY(e); ctx.beginPath(); ctx.moveTo(x, y); e.preventDefault(); }
    function draw(e) { if (!drawing) return; const { x, y } = getXY(e); ctx.lineTo(x, y); ctx.stroke(); e.preventDefault(); }
    function endDraw() { drawing = false; }
    canvas.addEventListener("mousedown", startDraw); canvas.addEventListener("mousemove", draw); canvas.addEventListener("mouseup", endDraw); canvas.addEventListener("mouseleave", endDraw);
    canvas.addEventListener("touchstart", startDraw); canvas.addEventListener("touchmove", draw); canvas.addEventListener("touchend", endDraw);
    function clearSignature() { ctx.clearRect(0, 0, canvas.width, canvas.height); document.getElementById("saved-signature").innerHTML = ""; }
    function saveSignature() { const dataURL = canvas.toDataURL("image/png"); const img = document.createElement("img"); img.src = dataURL; img.style.maxWidth = "100px"; document.getElementById('saved-signature').innerHTML = ""; document.getElementById("saved-signature").appendChild(img); }
    function handleUpload(event) { const file = event.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = function(e) { const img = document.createElement("img"); img.src = e.target.result; img.style.maxWidth = "220px"; document.getElementById('saved-signature').innerHTML = ""; document.getElementById("saved-signature").appendChild(img); }; reader.readAsDataURL(file); }
 
  // Sembunyikan logo & label perusahaan jika rekening tertentu
    if (bankAccountNumber === "2910822929") {
      document.getElementById("logo-container").style.display = "none";
      document.getElementById("invoice-number-row").style.display = "none";
    }
    if (bankAccountNumber === "4508787781") {
      document.getElementById("wgs-logo").style.display = "none";
      document.getElementById("invoice-number-row").style.display = "none";
    }
    if (bankAccountNumber === "2918524369") {
      document.getElementById("cmk-logo").style.display = "none";
    }
    if (clientName === "") {
      document.getElementById("submit-to").style.display = "none";
    }
    if (productionHouse === "") {
      document.getElementById("prod-house").style.display = "none";
    }
    if (companyName === "") {
      document.getElementById("comp-name").style.display = "none";
    }
    
  
    
  
  </script>
</body>
</html>
