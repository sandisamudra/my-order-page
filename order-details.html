<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print Quotation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header img {
            max-width: 150px;
        }

        .table-container {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 8px;
            text-align: left;
        }

        .grand-total {
            margin-top: 20px;
            text-align: right;
            font-size: 18px;
            font-weight: bold;
        }

        .signature-container {
            margin-top: 20px;
        }

        canvas {
            border: 1px solid black;
            width: 100%;
            height: 150px;
        }

        .btn-container {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 8px 12px;
            cursor: pointer;
        }

        /* Sembunyikan signature pad saat print */
        @media print {
            .signature-container { display: none; }
            #saved-signature-container { display: block; }
            #print-button { display: none; }
        }

        /* Area tanda tangan di bawah Grand Total */
        #saved-signature-container {
            display: none;
            margin-top: 20px;
            text-align: center;
            border: 1px solid #000;
            padding: 10px;
            width: 300px;
            position: absolute;
            right: 0;
        }

        #saved-signature-container img {
            width: 100%;
            border: 1px solid #000;
        }

        #saved-signature-container p {
            margin: 5px 0;
            font-weight: bold;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="brinks_logo.png" alt="Brinks Logo">
        <h2>Quotation</h2>
    </div>

    <p id="customer-headline"><strong>Customer Name :</strong> <span id="customer-name"></span></p>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Item</th>
                    <th>Quantity</th>
                    <th>From</th>
                    <th>To</th>
                    <th>Total Cost</th>
                </tr>
            </thead>
            <tbody id="order-table">
                <!-- Data dari Glide akan dimasukkan ke sini -->
            </tbody>
        </table>
    </div>

    <p class="grand-total">Grand Total: <span id="grand-total"></span></p>

    <!-- Area tanda tangan di bawah Grand Total -->
    <div id="saved-signature-container">
        <p>Customer Signature</p>
        <img id="saved-signature" src="" alt="Saved Signature">
        <p id="customer-name-signature"></p>
    </div>

    <!-- Signature Pad -->
    <div class="signature-container">
        <p><strong>Signature:</strong></p>
        <canvas id="signature-pad"></canvas>
        <div class="btn-container">
            <button id="clear-signature">Clear</button>
            <button id="save-signature">Save</button>
        </div>
    </div>

    <!-- Tombol Print -->
    <button id="print-button" onclick="window.print()">Print PDF</button>

</div>

<script>
    function getUrlParams() {
        const params = new URLSearchParams(window.location.search);
        return params;
    }

    function loadDataFromGlide() {
        const params = getUrlParams();

        // Ambil nama customer dari URL
        const customerName = params.get("customerName") || "Unknown Customer";
        document.getElementById("customer-name").textContent = customerName;

        // Ambil data order dari URL (encoded JSON)
        const orderData = params.get("orders");

        if (orderData) {
            const orders = JSON.parse(decodeURIComponent(orderData));
            const tableBody = document.getElementById("order-table");
            let grandTotal = 0;

            orders.forEach(order => {
                const row = document.createElement("tr");

                row.innerHTML = `
                    <td>${order.orderId}</td>
                    <td>${order.date}</td>
                    <td>${order.item}</td>
                    <td>${order.quantity}</td>
                    <td>${order.from}</td>
                    <td>${order.to}</td>
                    <td>${order.totalCost} IDR</td>
                `;

                tableBody.appendChild(row);
                grandTotal += parseInt(order.totalCost.replace(/,/g, ""));
            });

            document.getElementById("grand-total").textContent = grandTotal.toLocaleString() + " IDR";
        }
    }

    // Signature pad logic
    const canvas = document.getElementById("signature-pad");
    const ctx = canvas.getContext("2d");

    let isDrawing = false;

    canvas.addEventListener("mousedown", (e) => {
        isDrawing = true;
        ctx.beginPath();
        ctx.moveTo(e.offsetX, e.offsetY);
    });

    canvas.addEventListener("mousemove", (e) => {
        if (isDrawing) {
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
        }
    });

    canvas.addEventListener("mouseup", () => {
        isDrawing = false;
    });

    canvas.addEventListener("mouseleave", () => {
        isDrawing = false;
    });

    document.getElementById("clear-signature").addEventListener("click", () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    document.getElementById("save-signature").addEventListener("click", () => {
        const signatureDataURL = canvas.toDataURL();

        // Tampilkan tanda tangan di area kanan
        document.getElementById("saved-signature").src = signatureDataURL;
        document.getElementById("saved-signature-container").style.display = "block";

        // Ambil nama customer dari headline
        const customerName = document.getElementById("customer-name").textContent;
        document.getElementById("customer-name-signature").textContent = customerName;
    });

    // Load data saat halaman dibuka
    window.onload = loadDataFromGlide;
</script>

</body>
</html>
